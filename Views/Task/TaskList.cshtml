@model IEnumerable<TaskManagementSystem.ViewModel.TaskViewModel>
@{
    ViewBag.Title = "Task List";
    var toDoCount = Model.Count(t => t.Status == 1);
    var inProgressCount = Model.Count(t => t.Status == 2);
    var doneCount = Model.Count(t => t.Status == 3);
}

<div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 class="text-primary">Task Dashboard</h2>
        <div>
            <input type="text" id="taskSearch" class="form-control d-inline w-50" placeholder="Search Tasks..." onkeyup="filterTasks()">
            @Html.ActionLink("Create New Task", "CreateTask", "Task", null, new { @class = "btn btn-success ms-2" })
        </div>
    </div>

    <div class="row text-center mb-4">
        <div class="col-md-4">
            <div class="card text-white bg-info">
                <div class="card-body">
                    <h5 class="card-title">To Do</h5>
                    <h3>@toDoCount</h3>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card text-white bg-warning">
                <div class="card-body">
                    <h5 class="card-title">In Progress</h5>
                    <h3>@inProgressCount</h3>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card text-white bg-success">
                <div class="card-body">
                    <h5 class="card-title">Completed</h5>
                    <h3>@doneCount</h3>
                </div>
            </div>
        </div>
    </div>

    <table class="table table-bordered table-striped text-center" id="taskTable">
        <thead class="bg-dark text-white">
            <tr>
                <th>Task Id</th>
                <th>Title</th>
                <th>Description</th>
                <th>Date</th>
                <th>Status</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody>
            @if (Model.Any())
            {
                foreach (var task in Model)
                {
                    <tr>
                        <td>@task.TaskId</td>
                        <td>@task.Title</td>
                        <td>@task.Description</td>
                        <td>@task.DueDate</td>
                        <td>
                            @{ string statusText = task.Status switch
                                {
                                    1 => "To Do",
                                    2 => "In Progress",
                                    3 => "Done",
                                    _ => "Abort"
                                };
                            }
                            <span class="badge @(task.Status == 1 ? "bg-info" : task.Status == 2 ? "bg-warning" : "bg-success")">@statusText</span>
                        </td>                        <td>
                            @Html.ActionLink("Edit", "Edit", "Task", new { task.TaskId }, new { @class = "btn btn-primary btn-sm me-1" })
                        </td>
                    </tr>
                }
            }
            else
            {
                <tr>
                    <td colspan="7">No Records Available...</td>
                </tr>
            }
        </tbody>
    </table>
</div>

<script>
    function filterTasks() {
        var input, filter, table, tr, td, i, txtValue;
        input = document.getElementById("taskSearch");
        filter = input.value.toUpperCase();
        table = document.getElementById("taskTable");
        tr = table.getElementsByTagName("tr");

        for (i = 1; i < tr.length; i++) {
            td = tr[i].getElementsByTagName("td")[1];
            if (td) {
                txtValue = td.textContent || td.innerText;
                tr[i].style.display = txtValue.toUpperCase().indexOf(filter) > -1 ? "" : "none";
            }
        }
    }
</script>
